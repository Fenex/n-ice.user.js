// ==UserScript==
// @author      Vitaliy Busko
// @name        n-ice UserJS
// @version     1.0.0
// @description Adds position change from last view to current time at TOP-100 table on n-ice.org
// @match       http://www.n-ice.org/openttd/highscore.php
// @include     http://www.n-ice.org/openttd/highscore.php
// @match       http://www.n-ice.org/openttd/highscoretop100.php
// @include     http://www.n-ice.org/openttd/highscoretop100.php
// ==/UserScript==
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./modules/player"),e=a("./modules/utils/local-storage");if(/openttd\/highscore(top100)?\.php/.test(location.href)){var f=document.querySelectorAll("table.ranktable");if(f.length)for(var g=0;g<f.length;g++){var h=f[g].getElementsByTagName("caption")[0].textContent;e.setPrefixLS(h);var i=f[g].getElementsByTagName("tbody")[0],j=e.getJSON("players"),k=parseInt(e.get("last"));if(j&&k){for(var l=i.getElementsByTagName("tr"),m=0;m<l.length;m++)for(var n=d.LoadFromHTML(l[m]),o=0;o<j.length;o++)if(j[o].login==n.login){n.compare(j[o],l[m]);break}}else{for(var p=[],l=i.getElementsByTagName("tr"),m=0;m<l.length;m++)p.push(d.LoadFromHTML(l[m]));e.setJSON("players",p),k=(new Date).getTime(),e.set("last",k)}var q=a("./modules/ui")(f[g]);q.innerHTML=new Date(k).toLocaleString()}}},{"./modules/player":2,"./modules/ui":3,"./modules/utils/local-storage":4}],2:[function(a,b,c){function d(a){var b=document.createElement("span");b.className="amount-diff";var c=["(",'<span class="',void 0,'">',void 0,"</span>",")"];return c[2]=a>0?"diff-up":"diff-down",c[4]=(a>0?"+":"")+a,b.innerHTML=c.join(""),b}function e(a){var b={rank:parseInt(f.rank(a).textContent),login:f.login(a).textContent,score:parseInt(f.score(a).textContent)},c=new g(b);for(var d in b)c[d]=b[d];return c}var f={rank:function(a){return a.getElementsByTagName("th")[0]},login:function(a){return a.getElementsByTagName("td")[0]},score:function(a){return a.getElementsByTagName("th")[1]}},g=function(a){this.login=null,this.rank=null,this.score=null};g.prototype.compare=function(a,b){var c={rank:-1,score:1};for(var e in c)if(this[e]!=a[e]){var g=f[e](b),h=d((this[e]-a[e])*c[e]);g.appendChild(h)}},g.prototype.toString=function(){return"[object Player `"+this.login+"`]"},b.exports={LoadFromHTML:e}},{}],3:[function(a,b,c){function d(){var a=document.createElement("style");a.innerHTML=".diff-up{color: green;}.diff-down {color: brown;}.amount-diff{margin: 0px 1px;padding: 0px 3px;}",document.head.appendChild(a)}function e(a){var b=document.createElement("div");b.innerHTML='Show amount values change from timestamp: <b class="'+h+'">now</b>. ';var c=document.createElement("button");return c.innerHTML="Set timestamp to now",c.setAttribute("LS-key",a.getElementsByTagName("caption")[0].textContent),c.addEventListener("click",function(a){g.setPrefixLS(a.target.getAttribute("LS-key")),g.remove("last"),g.remove("players"),location.reload()}),b.appendChild(c),a.parentNode.insertBefore(b,a.previousSibling.previousSibling),b.getElementsByClassName(h)[0]}function f(a){return d(),e(a)}var g=a("./utils/local-storage"),h="diff-timestamp";b.exports=f},{"./utils/local-storage":4}],4:[function(a,b,c){function d(a){console.info("local-storage module: ",a)}function e(){return Math.floor((new Date).getTime()/1e3)}function f(a){return q+a}function g(a){return void 0!==localStorage[f(a)]}function h(a){return void 0===localStorage[f(a)]}function i(a,b){return g(a)?localStorage[f(a)]:b}function j(a,b){var c=i(a,b);if("string"!=typeof c)return c;var e=null;try{e=JSON.parse(c)}catch(f){d(f),e=b}return e}function k(a){delete localStorage[f(a)]}function l(a,b){return localStorage[f(a)]=b}function m(a,b){return l(a,JSON.stringify(b))}function n(a,b){if(!g(a))return b;var c=j(a,{});return"object"==typeof c&&c.t>e()?c.v:(k(a),b)}function o(a,b,c){return m(a,{t:e()+c,v:b})}function p(a){q=a}var q="FNX_";b.exports={Cache:{load:n,save:o},has:g,empty:h,get:i,set:l,remove:k,getJSON:j,setJSON:m,setPrefixLS:p}},{}]},{},[1]);